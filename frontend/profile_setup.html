<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è - EduPlatform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8">
            <h1 class="text-3xl font-bold text-indigo-600 mb-6">üéì –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è</h1>
            <p class="text-gray-600 mb-8">–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ, —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ –ø–æ–¥–æ–±—Ä–∞—Ç—å –¥–ª—è —Ç–µ–±—è –ª—É—á—à–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</p>

            <form id="profileForm">
                <!-- –ö–ª–∞—Å—Å -->
                <div class="mb-6">
                    <label class="block text-gray-700 font-semibold mb-2">–ö–ª–∞—Å—Å</label>
                    <select id="grade" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                        <option value="">–í—ã–±–µ—Ä–∏ –∫–ª–∞—Å—Å</option>
                        <option value="1">1 –∫–ª–∞—Å—Å</option>
                        <option value="2">2 –∫–ª–∞—Å—Å</option>
                        <option value="3">3 –∫–ª–∞—Å—Å</option>
                        <option value="4">4 –∫–ª–∞—Å—Å</option>
                        <option value="5">5 –∫–ª–∞—Å—Å</option>
                        <option value="6">6 –∫–ª–∞—Å—Å</option>
                        <option value="7">7 –∫–ª–∞—Å—Å</option>
                        <option value="8">8 –∫–ª–∞—Å—Å</option>
                        <option value="9">9 –∫–ª–∞—Å—Å</option>
                        <option value="10">10 –∫–ª–∞—Å—Å</option>
                        <option value="11">11 –∫–ª–∞—Å—Å</option>
                    </select>
                </div>

                <!-- –í–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞ -->
                <div class="mb-6">
                    <label class="block text-gray-700 font-semibold mb-2">–í–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞</label>
                    <select id="ageGroup" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                        <option value="">–í—ã–±–µ—Ä–∏ –≥—Ä—É–ø–ø—É</option>
                        <option value="junior">–ú–ª–∞–¥—à–∏–µ –∫–ª–∞—Å—Å—ã (1-4)</option>
                        <option value="middle">–°—Ä–µ–¥–Ω–∏–µ –∫–ª–∞—Å—Å—ã (5-8)</option>
                        <option value="senior">–°—Ç–∞—Ä—à–∏–µ –∫–ª–∞—Å—Å—ã (9-11)</option>
                    </select>
                </div>

                <!-- –ò–Ω—Ç–µ—Ä–µ—Å—ã -->
                <div class="mb-6">
                    <label class="block text-gray-700 font-semibold mb-2">–ò–Ω—Ç–µ—Ä–µ—Å—ã (–≤—ã–±–µ—Ä–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ)</label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" value="math" class="interest-checkbox">
                            <span>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" value="physics" class="interest-checkbox">
                            <span>–§–∏–∑–∏–∫–∞</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" value="chemistry" class="interest-checkbox">
                            <span>–•–∏–º–∏—è</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" value="biology" class="interest-checkbox">
                            <span>–ë–∏–æ–ª–æ–≥–∏—è</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" value="literature" class="interest-checkbox">
                            <span>–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" value="history" class="interest-checkbox">
                            <span>–ò—Å—Ç–æ—Ä–∏—è</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" value="programming" class="interest-checkbox">
                            <span>–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" value="art" class="interest-checkbox">
                            <span>–ò—Å–∫—É—Å—Å—Ç–≤–æ</span>
                        </label>
                    </div>
                </div>

                <!-- –°—Ç–∏–ª—å –æ–±—É—á–µ–Ω–∏—è -->
                <div class="mb-6">
                    <label class="block text-gray-700 font-semibold mb-2">–°—Ç–∏–ª—å –æ–±—É—á–µ–Ω–∏—è</label>
                    <select id="learningStyle" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                        <option value="">–ö–∞–∫ —Ç–µ–±–µ —É–¥–æ–±–Ω–µ–µ —É—á–∏—Ç—å—Å—è?</option>
                        <option value="visual">–í–∏–∑—É–∞–ª—å–Ω—ã–π (–≤–∏–¥–µ–æ, –∫–∞—Ä—Ç–∏–Ω–∫–∏)</option>
                        <option value="auditory">–ê—É–¥–∏–∞–ª—å–Ω—ã–π (–ª–µ–∫—Ü–∏–∏, –ø–æ–¥–∫–∞—Å—Ç—ã)</option>
                        <option value="kinesthetic">–ö–∏–Ω–µ—Å—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π (–ø—Ä–∞–∫—Ç–∏–∫–∞, —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã)</option>
                        <option value="mixed">–°–º–µ—à–∞–Ω–Ω—ã–π</option>
                    </select>
                </div>

                <!-- –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–µ —Ç–∏–ø—ã –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
                <div class="mb-6">
                    <label class="block text-gray-700 font-semibold mb-2">–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–µ —Ç–∏–ø—ã –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" value="video" class="resource-type-checkbox">
                            <span>üé• –í–∏–¥–µ–æ</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" value="reading" class="resource-type-checkbox">
                            <span>üìñ –ß—Ç–µ–Ω–∏–µ</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" value="exercise" class="resource-type-checkbox">
                            <span>‚úçÔ∏è –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" value="quiz" class="resource-type-checkbox">
                            <span>üìù –¢–µ—Å—Ç—ã</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" value="interactive" class="resource-type-checkbox">
                            <span>üéÆ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤</span>
                        </label>
                    </div>
                </div>

                <div id="errorMessage" class="hidden mb-4 p-3 bg-red-100 text-red-700 rounded-lg"></div>

                <button type="submit"
                    class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
                </button>
            </form>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // Protect page
        if (!protectStudentPage()) {
            throw new Error('Unauthorized');
        }

        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const grade = parseInt(document.getElementById('grade').value);
            const ageGroup = document.getElementById('ageGroup').value;
            const learningStyle = document.getElementById('learningStyle').value;

            // Get selected interests
            const interests = Array.from(document.querySelectorAll('.interest-checkbox:checked'))
                .map(cb => cb.value);

            // Get preferred resource types
            const resourceTypes = Array.from(document.querySelectorAll('.resource-type-checkbox:checked'))
                .map(cb => cb.value);

            if (interests.length === 0) {
                document.getElementById('errorMessage').textContent = '–í—ã–±–µ—Ä–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–Ω—Ç–µ—Ä–µ—Å';
                document.getElementById('errorMessage').classList.remove('hidden');
                return;
            }

            const profileData = {
                grade,
                age_group: ageGroup,
                interests,
                learning_style: learningStyle,
                preferences: {
                    preferred_resource_types: resourceTypes,
                    difficulty_preference: grade <= 4 ? 'easy' : grade <= 8 ? 'medium' : 'hard'
                }
            };

            try {
                await API.profile.create(profileData);
                window.location.href = '/dashboard.html';
            } catch (error) {
                const errorMsg = error.response?.data?.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è';
                document.getElementById('errorMessage').textContent = errorMsg;
                document.getElementById('errorMessage').classList.remove('hidden');
            }
        });
    </script>
</body>

</html>